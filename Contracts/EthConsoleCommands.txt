// Dev chain
var platformAddress = "0x1e2f51e97f2772dafe59d345bbe48c32a7d2b46b";
var clientAddress = "0x8298eca41e01f8c285e17e2546b8ceb0d24eda18";
var contractorAddress = "0x1d9de997cf7bedfb709881657df5a7b9cc5689fe";

var password = "password";

// transfer some ethers too client & contractor for gas
personal.unlockAccount(platformAddress, "password");
eth.sendTransaction({ from: platformAddress, to: clientAddress, value: web3.toWei(1, "ether")});

var abi = [{"constant":true,"inputs":[],"name":"getContractorAddress","outputs":[{"name":"_contractor","type":"address"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"pay","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"kill","outputs":[],"payable":false,"type":"function"},{"constant":false,"inputs":[{"name":"contractorAmount","type":"uint256"}],"name":"disputeSettlement","outputs":[],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"validate","outputs":[{"name":"","type":"bool"}],"payable":false,"type":"function"},{"constant":true,"inputs":[],"name":"getAllAddresses","outputs":[{"name":"","type":"address"},{"name":"","type":"address"},{"name":"","type":"uint256"}],"payable":false,"type":"function"},{"constant":false,"inputs":[],"name":"fund","outputs":[],"payable":true,"type":"function"},{"constant":false,"inputs":[{"name":"_contractor","type":"address"}],"name":"hire","outputs":[],"payable":false,"type":"function"},{"inputs":[{"name":"_platform","type":"address"}],"payable":false,"type":"constructor"},{"payable":false,"type":"fallback"}]
var bytecode = "0x6060604052341561000f57600080fd5b604051602080610783833981016040528080519060200190919050505b336000806101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff16021790555080600260006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b505b6106c4806100bf6000396000f3006060604052361561008c576000357c0100000000000000000000000000000000000000000000000000000000900463ffffffff1680630a48a1521461009f5780631b9265b8146100f457806341c0e1b51461010957806347d8664a1461011e5780636901f668146101415780639516a1041461016e578063b60d4288146101fd578063d9d6bd8614610207575b341561009757600080fd5b5b600080fd5b005b34156100aa57600080fd5b6100b2610240565b604051808273ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16815260200191505060405180910390f35b34156100ff57600080fd5b61010761026b565b005b341561011457600080fd5b61011c610336565b005b341561012957600080fd5b61013f600480803590602001909190505061043e565b005b341561014c57600080fd5b610154610523565b604051808215151515815260200191505060405180910390f35b341561017957600080fd5b61018161052d565b604051808473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff1681526020018373ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff168152602001828152602001935050505060405180910390f35b610205610588565b005b341561021257600080fd5b61023e600480803573ffffffffffffffffffffffffffffffffffffffff169060200190919050506105f7565b005b6000600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1690505b90565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156102c657600080fd5b600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6004549081150290604051600060405180830381858888f19350505050151561032a57600080fd5b60006004819055505b5b565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561039257600080fd5b60006004541115610401576000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc6004549081150290604051600060405180830381858888f19350505050151561040057600080fd5b5b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff16ff5b5b565b600260009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561049a57600080fd5b600081111561051657600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff166108fc829081150290604051600060405180830381858888f19350505050151561050557600080fd5b806004600082825403925050819055505b61051e610336565b5b5b50565b6000600190505b90565b60008060008060009054906101000a900473ffffffffffffffffffffffffffffffffffffffff16600160009054906101000a900473ffffffffffffffffffffffffffffffffffffffff1660648090509250925092505b909192565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff161415156105e357600080fd5b346004600082825401925050819055505b5b565b6000809054906101000a900473ffffffffffffffffffffffffffffffffffffffff1673ffffffffffffffffffffffffffffffffffffffff163373ffffffffffffffffffffffffffffffffffffffff1614151561065257600080fd5b80600160006101000a81548173ffffffffffffffffffffffffffffffffffffffff021916908373ffffffffffffffffffffffffffffffffffffffff1602179055505b5b505600a165627a7a72305820cb5a3529c4721a2120aab8e8d64e34db591ae5c4b90a4b380c0bd7a8440843b50029";
var gas = eth.estimateGas({ data: bytecode} ) * 2;

// deploying the contract using the client address
personal.unlockAccount(clientAddress, "password");
var contract = eth.contract(abi);
var instance = contract.new(platformAddress, { 
   from:clientAddress,
   data:bytecode,
   value: web3.toWei(0, "finney")
   gas:gas}, function(err, contractInstance){
    if(!err) {
       if(!contractInstance.address) {
           console.log("Tx Hash: " + contractInstance.transactionHash) // The hash of the transaction, which deploys the contract
       } else {
           console.log("Address: " + contractInstance.address) // the contract address
       }
    }
	else {
		console.log(err);
	}
});

// hiring the contractor
instance.hire(contractorAddress, { from: clientAddress });
// checking the contractor
instance.getContractorAddress();

// getting all addresseses
var (a, b, c) = instance.getAllAddresses();

// funding the contract
instance.fund({ from: clientAddress, value: web3.toWei(1, "finney")  });

// checking for the balance in contract
eth.getBalance(instance.address);

// paying the contractor and checking contractor balance
instance.pay({ from: clientAddress });
eth.getBalance(contractorAddress);
